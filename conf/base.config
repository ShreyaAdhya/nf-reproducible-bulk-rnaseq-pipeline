/*
 * Base configuration for bulk RNA-seq Nextflow pipeline
 */

params {

    // Input
    samplesheet = "assets/samplesheet.csv"

    // Reference files (override on command line)
    star_index  = null
    gtf         = null

    // Output
    outdir      = "results"

    // Resources
    max_cpus    = 16
    max_memory  = '64.GB'
    max_time    = '48.h'

    // Optional flags
    run_rseqc   = true
    run_multiqc = true
}

/*
 * Global process defaults
 */
process {

    publishDir = [
        path: { "${params.outdir}/${task.process}" },
        mode: 'copy'
    ]

    cpus   = 2
    memory = '8.GB'
    time   = '6.h'

    errorStrategy = 'retry'
    maxRetries    = 2
}

/*
 * Process-specific tuning
 */
process {

    withName: FASTQC {
        cpus   = 2
        memory = '4.GB'
        time   = '2.h'
    }

    withName: FASTP {
        cpus   = 4
        memory = '8.GB'
        time   = '4.h'
    }

    withName: STAR_ALIGN {
        cpus   = 8
        memory = '32.GB'
        time   = '24.h'
    }

    withName: FEATURECOUNTS {
        cpus   = 4
        memory = '8.GB'
        time   = '6.h'
    }

    withName: MULTIQC {
        cpus   = 2
        memory = '4.GB'
        time   = '2.h'
    }
}

/*
 * Execution reports
 */
timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_timeline.html"
}

report {
    enabled = true
    file    = "${params.outdir}/pipeline_report.html"
}

trace {
    enabled = true
    file    = "${params.outdir}/pipeline_trace.txt"
}
